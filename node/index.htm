<!-- <html>

<head>
    <title>文件上传表单</title>
</head>

<body>
    <h3>文件上传：</h3>
    选择一个文件上传: <br />
    <form action="/file_upload" method="post" enctype="multipart/form-data">

        First Name: <input type="text" name="first_name"> <br>

        Last Name: <input type="text" name="last_name">

        <input type="file" name="image" size="50" />
        <br />
        <input type="submit" value="上传文件" />
    </form>
</body>

</html> -->

<html>

<body>
    <form action="http://127.0.0.1:8081/process_post" method="POST">
        First Name: <input id="firstname" type="text" name="first_name"> <br>

        <input id="lastname" type="file" name="image" size="50" />
        Last Name: <input type="text" name="last_name">
        <input type="submit" value="Submit">
    </form>
    <button id="id-button">1111</button>


    <script>
        var ajax = function (request) {
            /*
            request 是一个 object, 有如下属性
                method, 请求的方法, string
                url, 请求的路径, string
                data, 请求发送的数据, 如果是 GET 方法则没这个值, string
                callback, 响应回调, function
        
            本题不会就放弃, 本题带了一个用法在下方
            */
            var r = new XMLHttpRequest()
            r.open(request.method, request.url, true)
            if (request.contentType !== undefined) {
                r.setRequestHeader('Content-Type', request.contentType)
            }
            r.onreadystatechange = function (event) {
                if (r.readyState === 4) {
                    request.callback(r.response)
                }
            }
            if (request.method === 'GET') {
                r.send()
            } else {
                r.send(request.data)
            }
        }
        var e = function (selector) {
            return document.querySelector(selector)
        }
        var butt = e("#id-button")
        butt.addEventListener('click', function (event) {
            var formData = new FormData()
            formData.append('firstname', e('#firstname').value)
            formData.append('lastname', e('#lastname').value)

            var request = {
                method: 'POST',
                url: '/process_post',
                data: formData,
                contentType: 'application/x-www-form-urlencoded',
                // contentType: 'multipart/form-data',
                callback: function (response) {
                    console.log('响应', response)
                    // var res = JSON.parse(response)
                }
            }
            ajax(request)


        })</script>
</body>

</html>